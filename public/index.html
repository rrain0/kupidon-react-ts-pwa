<!DOCTYPE html>
<html lang="en-US">


  <head>
    <meta charset="utf-8" />
    
    <script>
      const NODE_ENV = "%NODE_ENV%"
      const PUBLIC_URL = "%PUBLIC_URL%"
    </script>
    
    
    <title>Kupidon</title>
    <meta name="description" content="Kupidon date app" />
    
    <meta name="viewport"
      content="width=device-width, height=device-height, initial-scale=1, viewport-fit=cover"
    />
    
    <link rel="icon" href="%PUBLIC_URL%/logo64.png" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    
    
    <!-- Used as color of mobile browser toolbar in site mode -->
    <!-- Do not set it if use media="(prefers-color-scheme: ...)" -->
    <!--<meta name="theme-color" content="green" />-->
    
    <!-- works on site in mobile Chrome -->
    <!-- works in app on desktop Edge -->
    <!-- works in app on mobile Chrome -->
    <meta name="theme-color" content="#ffaeba" media="(prefers-color-scheme: light)" />
    <!-- NOT works on site in mobile Chrome -->
    <!-- works in app on desktop Edge -->
    <!-- works in app on mobile Chrome -->
    <meta name="theme-color" content="#992c46" media="(prefers-color-scheme: dark)" />
    
    
    
    
    
    <!--<script src="%PUBLIC_URL%/setup-app.js"></script>-->
    <script>
      
      console.log('setup app script: make setup')
      
      
      
      let _htmlProps = {
        // eslint-disable-next-line no-undef
        nodeEnv: NODE_ENV,
        // eslint-disable-next-line no-undef
        publicUrl: PUBLIC_URL,
        lang: "en-US",
        title: "Kupidon",
        description: "Kupidon date app",
      }
      
      function setHtmlTags(langs){
        if (langs[0]) {
          _htmlProps.lang = langs[0]
          
          const textPrefix = _htmlProps.nodeEnv==='development' ? 'Dev ' : ''
          
          const AppTitles = [
            {
              value: 'kupidon',
              lang: 'en-US',
              text: 'Kupidon',
            },
            {
              value: 'kupidon',
              lang: 'ru-RU',
              text: 'Купидон',
            },
          ]
          const AppDescriptions = [
            {
              value: 'kupidonDescription',
              lang: 'en-US',
              text: 'Kupidon date app',
            },
            {
              value: 'kupidonDescription',
              lang: 'ru-RU',
              text: 'Купидон - приложение для свидания',
            },
          ]
          
          const prepareUiOptions = function(uiOptions, langs){
            const used = new Set()
            return [...uiOptions]
              .sort((a,b)=>{
                if (a.value===b.value) {
                  let langIdxA = langs.findIndex(it=>it===a.lang)
                  let langIdxB = langs.findIndex(it=>it===b.lang)
                  if (langIdxA===-1) langIdxA = langs.length
                  if (langIdxB===-1) langIdxB = langs.length
                  return langIdxA - langIdxB
                }
                return 0
              })
              .filter(it=>{
                if (used.has(it.value)) return false
                used.add(it.value)
                return true
              })
          }
          
          const titles = prepareUiOptions(AppTitles,langs)
          const descriptions = prepareUiOptions(AppDescriptions,langs)
          
          _htmlProps.title = textPrefix + titles[0].text
          _htmlProps.description = textPrefix + descriptions[0].text
        }
        
        const html = document.documentElement
        html.lang = _htmlProps.lang
        
        document.title = _htmlProps.title
        
        const htmlDescription = document.querySelector('html head meta[name=description]')
        htmlDescription.content = _htmlProps.description
        
        const manifestSearchParams = new URLSearchParams({
          nodeEnv: _htmlProps.nodeEnv,
          lang: _htmlProps.lang,
        }).toString()
        let manifestUrl = _htmlProps.publicUrl + "/manifest.json"
        if (manifestSearchParams) manifestUrl += '?' + manifestSearchParams
        
        const linkManifest = document.querySelector('html head link[rel=manifest]')
        linkManifest.href = manifestUrl
      }
      
      
      
      
      const langSettingsName = 'langSettings'
      const AppLangs = ['en-US','ru-RU']
      {
        
        const langSettings = JSON.parse(localStorage.getItem(langSettingsName))
        if (langSettings?.setting==='manual'){
          setHtmlTags(langSettings.manualSetting)
        } else {
          
          const getLangs = function(){
            let browserLangs = navigator.languages
            if ((!browserLangs || !browserLangs.length) && navigator.language)
              browserLangs = [navigator.language]
            if (!browserLangs || !browserLangs.length) browserLangs = undefined
            browserLangs = browserLangs?.map(it=>{
              if (it.startsWith('en')) return 'en-US'
              if (it.startsWith('ru')) return 'ru-RU'
              return it
            })
            return browserLangs
          }
          
          let langs = getLangs().filter(it=>AppLangs.includes(it))
          if (!langs.length) langs = ['en-US']
          
          setHtmlTags(langs)
        }
        
        
      }
      
      
      
      
      /*
      https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/How_to/Trigger_install_prompt
      BeforeInstallEvent отправляется браузером, если он определил, что сайт можно установить как PWA.
      При первой отправке эвента, браузер показывает свой UI с предолжением установки (его отключаем ev.preventDefault()).
      Запрос на установку из эвента можно вызвать только 1 раз, дальше нужен новый эвент.
      При отклонении запроса на установку, браузер сразу же отправляет новый эвент.
      */
      let beforeInstallPromptEvent
      let onBeforeInstallPromptEvent
      const setBeforeInstallPromptEvent = ev=>{
        beforeInstallPromptEvent = ev
        onBeforeInstallPromptEvent?.(beforeInstallPromptEvent)
      }
      const promptInstall = ()=>{
        const ev = beforeInstallPromptEvent
        setBeforeInstallPromptEvent(undefined)
        return ev?.prompt()
      }
      window.addEventListener('beforeinstallprompt', async ev=>{
        // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/getInstalledRelatedApps
        const relatedApps = await navigator.getInstalledRelatedApps() // => { id, platform, url, version }[]
        // Search for a specific installed platform-specific app
        ev.preventDefault()
        if (!relatedApps?.length) setBeforeInstallPromptEvent(ev)
      })
      window.addEventListener('appinstalled', ev=>{
        setBeforeInstallPromptEvent(undefined)
      })
      
      
      
      
      console.log('setup app script: end of setup')
    </script>
    
    
    
    
    
    
    
    
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    
    
  </head>
  
  
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>


</html>
